<head>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<div class="flex">
  <!-- sidebar -->
  <div class="w-50 flex flex-col bg-blue-500">
    <div class="flex items-center justify-center">
      <div class="flex items-center">
        <span class="text-2xl font-semibold text-gray-800 dark:text-white">Admin Dashboard</span>
      </div>
    </div>

    <nav class="h-screen w-64 bg-gray-800">
      <ul class="text-white">
        <li class="px-4 py-2 text-lg font-medium"><a href="#accounts" class="text-white">Accounts</a></li>
        <li class="px-4 py-2 text-sm">
          <ul>
            <li><a href="#users" class="text-white">Users</a></li>
            <li><a href="#contractors" class="text-white">Contractors</a></li>
          </ul>
        </li>
        <li class="px-4 py-2 text-lg font-medium"><a href="#listings" class="text-white">Listings</a></li>
        <li class="px-4 py-2 text-sm">
          <ul>
            <li><a href="#contractor-listings" class="text-white">Contractor Listings</a></li>
            <li><a href="#car-listings" class="text-white">Car Listings</a></li>
          </ul>
        </li>
        <li class="px-4 py-2 text-lg font-medium"><a href="#wallet" class="text-white">Wallet</a></li>
        <li class="px-4 py-2 text-sm">
          <ul>
            <li><a href="#e-wallet" class="text-white">E-wallet</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>

  <!-- Table!-->
  <div class="mx-auto">
    <div class="relative overflow-x-auto shadow-md sm:rounded-lg">
      <table class="w-full text-left text-sm text-gray-500 dark:text-gray-400">
        <thead class="bg-gray-50 text-xs uppercase text-gray-700 dark:bg-gray-700 dark:text-gray-400">
          <tr>
            <th scope="col" class="px-6 py-3">Name</th>
            <th scope="col" class="px-6 py-3">Contact Number</th>
            <th scope="col" class="px-6 py-3">Email Address</th>
            <th scope="col" class="px-6 py-3">Password</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for key, users in user.items() %}
          <tr class="border-b bg-white hover:bg-gray-500 dark:border-gray-700 dark:bg-gray-900">
            <th scope="row" class="whitespace-nowrap px-6 py-4 font-medium text-white">{{users.full_name}}</th>
            <td class="px-6 py-4">{{users.phone_number}}</td>
            <td class="px-6 py-4">{{users.email}}</td>
            <td class="px-6 py-4">{{users.password}}</td>
            <td class="px-6 py-4">
              <button onclick="editUser('{{users.email}}', '{{users.full_name}}', '{{users.phone_number}}')"
                class="font-medium text-blue-600 hover:underline dark:text-blue-500">Edit</button>
            </td>
            <td class="px-6 py-4">
              <a href="#" class="font-medium text-red-600 hover:underline dark:text-red-500" id='delete-button'
                onclick='deleteUser("{{ users.email }}")'>Delete </a>
            </td>
            {%endfor%}
          </tr>
        </tbody>
      </table>
    </div>
  </div>



</div>

</div>

<!--Update-->
<div class='hidden w-full fixed z-40 inset-0 bg-slate-500/50 ' id='update_popup'>
  <div class='bg-white px-8 py-6 rounded-lg absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-50'
    id='confirmation'>
    <form>
      <div class="mb-4">
        <label class="block font-bold mb-2" for="editUID">UID</label>
        <input class="w-full px-3 py-2 rounded-lg shadow-sm" type="text" id="editUID" readonly>
      </div>
      <div class="mb-4">
        <label class="block font-bold mb-2" for="editFullName">Name</label>
        <input class="w-full px-3 py-2 rounded-lg shadow-sm" type="text" id="editFullName">
      </div>
      <div class="mb-4">
        <label class="block font-bold mb-2" for="editPhoneNumber">Contact Number</label>
        <input class="w-full px-3 py-2 rounded-lg shadow-sm" type="tel" id="editPhoneNumber" placeholder="8391 2912">
      </div>
      <div class="mb-4">
        <label class="block font-bold mb-2" for="editPassword">Password</label>
        <input class="w-full px-3 py-2 rounded-lg shadow-sm" type="text" id="editPassword" placeholder="*******">
      </div>

      <span id="updateErrorText" class="text-red-600 font-bold"></span>
    </form>
    <button
      class="mt-3 w-32 px-4 py-2 font-bold text-blue-500 border-2 border-blue-500 duration-200 ease-out rounded-md hover:bg-blue-700 focus:outline-none focus:shadow-outline"
      id='cancel-button' onclick='updateCancel()'>
      Cancel
    </button>
    <button onclick='updateRequest()'
      class="mt-3 w-32 px-4 py-2 font-bold border-2 border-blue-500 text-white bg-blue-500   rounded-md hover:bg-blue-700 focus:outline-none focus:shadow-outline"
      id='confirm-button'>
      Update
    </button>


  </div>
</div>
<script>
  const popup = document.getElementById('update_popup')
  const updateErrorText = document.getElementById('updateErrorText')
  const editUID = document.getElementById('editUID')
  const editFullName = document.getElementById('editFullName')
  const editPhoneNumber = document.getElementById('editPhoneNumber')
  const userapi_url = {{ url_for("userapiendpoint") | tojson}}

  function deleteUser(uid) {
    const yes = confirm("Are you sure?")
    if (!yes) return

    fetch(`${userapi_url}/${uid}`, {
      "method": "DELETE",
      "headers": { "Content-Type": "application/json" },
    })
      .then(setTimeout(() => window.location.href = '/account/admin-dashboard', 1500))
  }

  function editUser(uid, full_name, phone_number) {
    editUID.value = uid
    editFullName.value = full_name
    editPhoneNumber.value = phone_number

    popup.classList.toggle('hidden')
  }

  function updateCancel() {
    updateErrorText.innerText = ''
    popup.classList.toggle('hidden')
  }

  function updateRequest() {
    if (!editFullName.value || !editPhoneNumber.value) {
      updateErrorText.innerText = "Full Name and Phone Number are required!"
      return
    }

    fetch(`${userapi_url}/${editUID.value}`, {
      "method": "PUT",
      "headers": { "Content-Type": "application/json" },
      "body": JSON.stringify({
        "full_name": editFullName.value,
        "phone_number": editPhoneNumber.value,
      })
    }).then(setTimeout(() => window.location.reload(), 250))
  }

  function show_confirmation(uid) {
    let overlay = document.getElementById('popup-overlay');
    overlay.classList.remove('hidden')
    return uid
  }

  function delRequest() {


    let confirmation_text = document.getElementById('confirmation-text');
    let success_delete = document.getElementById('success-delete');
    let cancel_button = document.getElementById('cancel-button');
    let confirm_button = document.getElementById('confirm-button');

    success_delete.classList.remove('hidden');
    x
    confirmation_text.classList.add('hidden');
    cancel_button.classList.add('hidden');
    confirm_button.classList.add('hidden');


    fetch(`${userapi_url}/${user_email}`, {
      "method": "DELETE",
      "redirect": 'follow',
      "headers": { "Content-Type": "application/json" },
    })
      .then(setTimeout(() => window.location.href = '/', 1500))
  }


  function cancel_delete() {
    let overlay = document.getElementById('popup-overlay');
    overlay.classList.add('hidden')
  }

</script>